#include "huc.h"

#include "..\define.h"

const u16 Palette[] = {
  COLOR_TRANSPARENT,
  COLOR_WHITE, 
  COLOR_MAGENTA, 
  COLOR_LIGHTBLUE, 
  COLOR_BLACK, 
  COLOR_BLACK, 
  COLOR_BLACK,
  COLOR_BLACK,
  COLOR_BLACK, 
  COLOR_BLACK,
  COLOR_BLACK, 
  COLOR_BLACK, 
  COLOR_BLACK, 
  COLOR_BLACK, 
  COLOR_BLACK, 
  COLOR_BLACK
};

/* Index of COLOR_BLACK, COLOR_WHITE, COLOR_MAGENTA, COLOR_LIGHTBLUE */
/*
#define T 0
#define W 1 
#define M 2 
#define L 3
#define B 4
*/
/* Normal index color picture data */
/*
const u16 Picture[] = {
  T, T, T, M, W, T, W, W, W, W, W, W, T, T, T, T,
  T, T, T, T, T, W, W, W, W, W, W, W, W, T, T, T,
  T, T, T, T, W, W, W, M, M, B, M, B, M, T, T, T,
  T, T, T, T, W, W, W, M, M, B, M, B, M, T, T, T,
  T, T, T, T, T, W, W, W, W, W, W, W, W, T, T, T,
  T, T, T, T, T, L, W, W, W, W, W, W, T, T, T, T,
  T, T, T, T, T, L, L, L, L, L, L, T, T, T, T, T,
  T, T, T, T, L, L, W, W, W, L, T, M, M, T, T, T,
  T, T, M, M, L, L, W, W, W, W, W, M, M, T, T, T,
  T, T, M, M, L, L, L, W, W, W, W, T, T, T, T, T,
  T, T, T, T, L, L, L, L, L, L, T, T, M, T, T, T,
  T, T, T, T, L, L, W, L, L, L, W, M, M, T, T, T,
  T, T, T, W, W, W, W, L, L, W, W, M, M, T, T, T,
  T, T, M, M, W, W, W, T, L, L, W, M, M, T, T, T,
  T, T, T, M, M, T, T, T, T, T, T, T, T, T, T, T,
  T, T, T, T, M, M, T, T, T, T, T, T, T, T, T, T,
};
*/

/*
Plane0 is masked part of color index with 1 -> (color index & 1) ? 1 : 0
Plane1 is masked part of color index with 2 -> (color index & 2) ? 1 : 0
Plane2 is masked part of color index with 4 -> (color index & 4) ? 1 : 0
Plane3 is masked part of color index with 8 -> (color index & 8) ? 1 : 0
*/
#define T0 0 /* (Index of COLOR_TRANSPARENT & 1) ? 1 : 0 */
#define T1 0 /* (Index of COLOR_TRANSPARENT & 2) ? 1 : 0 */
#define T2 0 /* (Index of COLOR_TRANSPARENT & 4) ? 1 : 0 */
#define T3 0 /* (Index of COLOR_TRANSPARENT & 8) ? 1 : 0 */

#define W0 1
#define W1 0 
#define W2 0 
#define W3 0

#define M0 0 
#define M1 1 
#define M2 0 
#define M3 0 

#define L0 1 
#define L1 1 
#define L2 0 
#define L3 0

#define B0 0
#define B1 0 
#define B2 1 
#define B3 0

const u16 Pattern[] = {
  /* Plane 0 */
  T0<<15|T0<<14|T0<<13|M0<<12|W0<<11|T0<<10|W0<<9|W0<<8|W0<<7|W0<<6|W0<<5|W0<<4|T0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|T0<<11|W0<<10|W0<<9|W0<<8|W0<<7|W0<<6|W0<<5|W0<<4|W0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|W0<<11|W0<<10|W0<<9|M0<<8|M0<<7|B0<<6|M0<<5|B0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|W0<<11|W0<<10|W0<<9|M0<<8|M0<<7|B0<<6|M0<<5|B0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  
  T0<<15|T0<<14|T0<<13|T0<<12|T0<<11|W0<<10|W0<<9|W0<<8|W0<<7|W0<<6|W0<<5|W0<<4|W0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|T0<<11|L0<<10|W0<<9|W0<<8|W0<<7|W0<<6|W0<<5|W0<<4|T0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|T0<<11|L0<<10|L0<<9|L0<<8|L0<<7|L0<<6|L0<<5|T0<<4|T0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|L0<<11|L0<<10|W0<<9|W0<<8|W0<<7|L0<<6|T0<<5|M0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  
  T0<<15|T0<<14|M0<<13|M0<<12|L0<<11|L0<<10|W0<<9|W0<<8|W0<<7|W0<<6|W0<<5|M0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|M0<<13|M0<<12|L0<<11|L0<<10|L0<<9|W0<<8|W0<<7|W0<<6|W0<<5|T0<<4|T0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|L0<<11|L0<<10|L0<<9|L0<<8|L0<<7|L0<<6|T0<<5|T0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|L0<<11|L0<<10|W0<<9|L0<<8|L0<<7|L0<<6|W0<<5|M0<<4|M0<<3|T0<<2|T0<<1|T0<<0,

  T0<<15|T0<<14|T0<<13|W0<<12|W0<<11|W0<<10|W0<<9|L0<<8|L0<<7|W0<<6|W0<<5|M0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|M0<<13|M0<<12|W0<<11|W0<<10|W0<<9|T0<<8|L0<<7|L0<<6|W0<<5|M0<<4|M0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|M0<<12|M0<<11|T0<<10|T0<<9|T0<<8|T0<<7|T0<<6|T0<<5|T0<<4|T0<<3|T0<<2|T0<<1|T0<<0,
  T0<<15|T0<<14|T0<<13|T0<<12|M0<<11|M0<<10|T0<<9|T0<<8|T0<<7|T0<<6|T0<<5|T0<<4|T0<<3|T0<<2|T0<<1|T0<<0,

  /* Plane 1 */
  T1<<15|T1<<14|T1<<13|M1<<12|W1<<11|T1<<10|W1<<9|W1<<8|W1<<7|W1<<6|W1<<5|W1<<4|T1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|T1<<11|W1<<10|W1<<9|W1<<8|W1<<7|W1<<6|W1<<5|W1<<4|W1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|W1<<11|W1<<10|W1<<9|M1<<8|M1<<7|B1<<6|M1<<5|B1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|W1<<11|W1<<10|W1<<9|M1<<8|M1<<7|B1<<6|M1<<5|B1<<4|M1<<3|T1<<2|T1<<1|T1<<0,

  T1<<15|T1<<14|T1<<13|T1<<12|T1<<11|W1<<10|W1<<9|W1<<8|W1<<7|W1<<6|W1<<5|W1<<4|W1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|T1<<11|L1<<10|W1<<9|W1<<8|W1<<7|W1<<6|W1<<5|W1<<4|T1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|T1<<11|L1<<10|L1<<9|L1<<8|L1<<7|L1<<6|L1<<5|T1<<4|T1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|L1<<11|L1<<10|W1<<9|W1<<8|W1<<7|L1<<6|T1<<5|M1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  
  T1<<15|T1<<14|M1<<13|M1<<12|L1<<11|L1<<10|W1<<9|W1<<8|W1<<7|W1<<6|W1<<5|M1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|M1<<13|M1<<12|L1<<11|L1<<10|L1<<9|W1<<8|W1<<7|W1<<6|W1<<5|T1<<4|T1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|L1<<11|L1<<10|L1<<9|L1<<8|L1<<7|L1<<6|T1<<5|T1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|L1<<11|L1<<10|W1<<9|L1<<8|L1<<7|L1<<6|W1<<5|M1<<4|M1<<3|T1<<2|T1<<1|T1<<0,

  T1<<15|T1<<14|T1<<13|W1<<12|W1<<11|W1<<10|W1<<9|L1<<8|L1<<7|W1<<6|W1<<5|M1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|M1<<13|M1<<12|W1<<11|W1<<10|W1<<9|T1<<8|L1<<7|L1<<6|W1<<5|M1<<4|M1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|M1<<12|M1<<11|T1<<10|T1<<9|T1<<8|T1<<7|T1<<6|T1<<5|T1<<4|T1<<3|T1<<2|T1<<1|T1<<0,
  T1<<15|T1<<14|T1<<13|T1<<12|M1<<11|M1<<10|T1<<9|T1<<8|T1<<7|T1<<6|T1<<5|T1<<4|T1<<3|T1<<2|T1<<1|T1<<0,

  /* Plane 2 */
  T2<<15|T2<<14|T2<<13|M2<<12|W2<<11|T2<<10|W2<<9|W2<<8|W2<<7|W2<<6|W2<<5|W2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|T2<<11|W2<<10|W2<<9|W2<<8|W2<<7|W2<<6|W2<<5|W2<<4|W2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|W2<<11|W2<<10|W2<<9|M2<<8|M2<<7|B2<<6|M2<<5|B2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|W2<<11|W2<<10|W2<<9|M2<<8|M2<<7|B2<<6|M2<<5|B2<<4|M2<<3|T2<<2|T2<<1|T2<<0,

  T2<<15|T2<<14|T2<<13|T2<<12|T2<<11|W2<<10|W2<<9|W2<<8|W2<<7|W2<<6|W2<<5|W2<<4|W2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|T2<<11|L2<<10|W2<<9|W2<<8|W2<<7|W2<<6|W2<<5|W2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|T2<<11|L2<<10|L2<<9|L2<<8|L2<<7|L2<<6|L2<<5|T2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|L2<<11|L2<<10|W2<<9|W2<<8|W2<<7|L2<<6|T2<<5|M2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  
  T2<<15|T2<<14|M2<<13|M2<<12|L2<<11|L2<<10|W2<<9|W2<<8|W2<<7|W2<<6|W2<<5|M2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|M2<<13|M2<<12|L2<<11|L2<<10|L2<<9|W2<<8|W2<<7|W2<<6|W2<<5|T2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|L2<<11|L2<<10|L2<<9|L2<<8|L2<<7|L2<<6|T2<<5|T2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|L2<<11|L2<<10|W2<<9|L2<<8|L2<<7|L2<<6|W2<<5|M2<<4|M2<<3|T2<<2|T2<<1|T2<<0,

  T2<<15|T2<<14|T2<<13|W2<<12|W2<<11|W2<<10|W2<<9|L2<<8|L2<<7|W2<<6|W2<<5|M2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|M2<<13|M2<<12|W2<<11|W2<<10|W2<<9|T2<<8|L2<<7|L2<<6|W2<<5|M2<<4|M2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|M2<<12|M2<<11|T2<<10|T2<<9|T2<<8|T2<<7|T2<<6|T2<<5|T2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  T2<<15|T2<<14|T2<<13|T2<<12|M2<<11|M2<<10|T2<<9|T2<<8|T2<<7|T2<<6|T2<<5|T2<<4|T2<<3|T2<<2|T2<<1|T2<<0,
  
  /* Plane 3 */
  T3<<15|T3<<14|T3<<13|M3<<12|W3<<11|T3<<10|W3<<9|W3<<8|W3<<7|W3<<6|W3<<5|W3<<4|T3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|T3<<11|W3<<10|W3<<9|W3<<8|W3<<7|W3<<6|W3<<5|W3<<4|W3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|W3<<11|W3<<10|W3<<9|M3<<8|M3<<7|B3<<6|M3<<5|B3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|W3<<11|W3<<10|W3<<9|M3<<8|M3<<7|B3<<6|M3<<5|B3<<4|M3<<3|T3<<2|T3<<1|T3<<0,

  T3<<15|T3<<14|T3<<13|T3<<12|T3<<11|W3<<10|W3<<9|W3<<8|W3<<7|W3<<6|W3<<5|W3<<4|W3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|T3<<11|L3<<10|W3<<9|W3<<8|W3<<7|W3<<6|W3<<5|W3<<4|T3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|T3<<11|L3<<10|L3<<9|L3<<8|L3<<7|L3<<6|L3<<5|T3<<4|T3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|L3<<11|L3<<10|W3<<9|W3<<8|W3<<7|L3<<6|T3<<5|M3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  
  T3<<15|T3<<14|M3<<13|M3<<12|L3<<11|L3<<10|W3<<9|W3<<8|W3<<7|W3<<6|W3<<5|M3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|M3<<13|M3<<12|L3<<11|L3<<10|L3<<9|W3<<8|W3<<7|W3<<6|W3<<5|T3<<4|T3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|L3<<11|L3<<10|L3<<9|L3<<8|L3<<7|L3<<6|T3<<5|T3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|L3<<11|L3<<10|W3<<9|L3<<8|L3<<7|L3<<6|W3<<5|M3<<4|M3<<3|T3<<2|T3<<1|T3<<0,

  T3<<15|T3<<14|T3<<13|W3<<12|W3<<11|W3<<10|W3<<9|L3<<8|L3<<7|W3<<6|W3<<5|M3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|M3<<13|M3<<12|W3<<11|W3<<10|W3<<9|T3<<8|L3<<7|L3<<6|W3<<5|M3<<4|M3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|M3<<12|M3<<11|T3<<10|T3<<9|T3<<8|T3<<7|T3<<6|T3<<5|T3<<4|T3<<3|T3<<2|T3<<1|T3<<0,
  T3<<15|T3<<14|T3<<13|T3<<12|M3<<11|M3<<10|T3<<9|T3<<8|T3<<7|T3<<6|T3<<5|T3<<4|T3<<3|T3<<2|T3<<1|T3<<0
 };

PutSpritesRandom()
{
  u8 i;
  for(i = 0;i < SPR_MAX;++i){
      spr_set(i);
      spr_x((rand() % SCREEN_WIDTH) - 8);
      spr_y((rand() % SCREEN_HEIGHT) - 8);
  }
}

#define SPR_VRAM 0x4000/*0x6000*/

main()
{
  u8 KeyState;
  u8 i;

  /* To VRAM */
  load_vram(SPR_VRAM, Pattern, SPR_WORDSIZE_16x16);
  set_sprpal(0, Palette, 1);

  /* Initialize Sprite Attribute Table */
  init_satb();

  for(i = 0;i < SPR_MAX;++i) {
    /* Sprite no [0, 63] */
    spr_set(i);
    /* Size(16x16, 16x32, 16x64, 32x16, 32x32, 32x64), Flip settings */
    spr_ctrl(SIZE_MAS | FLIP_MAS, SZ_16x16 | NO_FLIP);
    /* Select pattern */
    spr_pattern(SPR_VRAM);
    /* Select palette [0, 15] */
    spr_pal(0);
    /* Priority [0, 1] */
    /* 0 : Behind of BG, 1 : Front of BG */
    spr_pri(1);
    /* Hide, show */
    spr_hide();
    spr_show();
  }

  PutSpritesRandom(); 
  while(1){
    vsync();

    KeyState = joy(JOY_PAD0);
    for(i = 0;i < SPR_MAX;++i){
      spr_set(i);
      if(KeyState & JOY_LEFT) spr_x(spr_get_x() - 1);
      if(KeyState & JOY_RGHT) spr_x(spr_get_x() + 1);
      if(KeyState & JOY_UP) spr_y(spr_get_y() - 1);
      if(KeyState & JOY_DOWN) spr_y(spr_get_y() + 1);
    }

    if(joytrg(JOY_PAD0) & (JOY_A | JOY_B)){
      PutSpritesRandom();
    }
   
    /* Sprite Attribute Table update */
    satb_update();
  }
}